<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Ny. Goan - Pastel & Puding</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico?v=1.5">
    <link rel="apple-touch-icon" href="favicon.ico?v=1.5">
    <style>
        :root { 
            --primary: #4A321F; 
            --accent: #E9C44C;  
            --light-yellow: #FFF9E6; 
            --bg: #fafafa;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #3e2723; }
        .container { max-width: 800px; margin: auto; }
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; background: #efebe9; padding: 6px; border-radius: 15px; }
        .tab-btn { 
            flex: 1; padding: 14px; border: none; border-radius: 10px; cursor: pointer; 
            font-weight: bold; font-size: 1rem; color: #795548; background: none; transition: 0.3s;
        }
        .tab-btn.active { background: white; color: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .card { background: white; padding: 20px; border-radius: 18px; box-shadow: 0 6px 15px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #eee; }
        .hidden { display: none; }
        .big-input { 
            width: 100%; padding: 16px; font-size: 1.2rem; border: 2px solid #d7ccc8; 
            border-radius: 12px; margin-bottom: 12px; box-sizing: border-box; background: #fff;
        }
        label { font-weight: bold; display: block; margin-bottom: 8px; color: var(--primary); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: var(--light-yellow); padding: 12px; text-align: left; border-bottom: 2px solid var(--accent); }
        td { padding: 12px; border-bottom: 1px solid #f5f5f5; }
        .btn { padding: 16px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 1.1rem; width: 100%; }
        .btn-add { background: var(--primary); color: white; }
        .btn-calc { background: var(--accent); color: var(--primary); margin-top: 15px; }
        .btn-copy { background: var(--primary); color: white; padding: 10px 20px; width: auto; float: right; margin-bottom: 10px; font-size: 0.9rem; }
        .row-active { background-color: var(--light-yellow) !important; font-weight: bold; }
        .badge-qty { background: var(--accent); padding: 4px 8px; border-radius: 6px; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 20px;">
        <h1 style="color: var(--primary); margin: 0;">Ny. Goan</h1>
        <p style="margin: 5px 0; color: #8d6e63; font-weight: bold;">Inventory System</p>
    </div>

    <div class="tabs">
        <button class="tab-btn active" id="btn-sales" onclick="switchTab('tab-sales')">üõí Penjualan</button>
        <button class="tab-btn" id="btn-resep" onclick="switchTab('tab-resep')">‚öôÔ∏è Setelan</button>
    </div>

    <div id="tab-sales" class="tab-content">
        <div class="card">
            <table id="tableSales">
                <thead><tr><th>Menu</th><th width="120">Laku</th></tr></thead>
                <tbody id="bodySales"></tbody>
            </table>
            <button class="btn btn-calc" onclick="calculateTotal()">üî• HITUNG STOK KELUAR</button>
        </div>
        <div id="resultSection" class="card hidden" style="border: 2px solid var(--accent); background: var(--light-yellow);">
            <button class="btn btn-copy" onclick="copyOnlyNumbers()">üìã Salin Angka</button>
            <h2 style="color: var(--primary); margin-top:0">Total Bahan Keluar</h2>
            <table id="tableFinal" style="background: white; border-radius: 10px;">
                <tbody id="bodyFinal"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-resep" class="tab-content hidden">
        <div class="card">
            <label>Nama Menu</label>
            <input type="text" id="mName" class="big-input" placeholder="Contoh: PASTEL DAGING">
            <label>Bahan Baku</label>
            <select id="mBahanSelect" class="big-input"></select>
            <label>Jumlah</label>
            <input type="number" id="mQty" class="big-input" placeholder="0">
            <button class="btn btn-add" onclick="addResep()">TAMBAH KE RESEP</button>
        </div>
        <div class="card">
            <table id="tableResep">
                <thead><tr><th>Menu</th><th>Bahan</th><th>Qty</th><th>Aksi</th></tr></thead>
                <tbody id="bodyResep"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const BARANG_TETAP = ["PASTEL DAGING", "PASTEL AYAM", "STIKER BULAT", "DUS SELUSIN", "DUS 1/2 LUSIN", "DUS 2 PCS", "STIKER PANJANG", "PUDING CARAMEL", "PUDING MANGGA", "PLASTIK 35", "PLASTIK 25", "PLASTIK 15", "MINYAK", "KERTAS ROTI 1 LUSIN", "KERTAS ROTI 1/2 LUSIN", "LABEL FROZEN", "KABEL TIES", "KERTAS THERMAL", "PITA", "KARTU UCAPAN", "KANTONG BAG 1 LUSIN", "KANTONG BAG 1/2 LUSIN", "SENDOK PUDING", "KERTAS PRINT TOKPED SHOPEE", "SAMBAL KACANG", "SAMBAL KACANG FROZEN", "PAPPER CUP", "MINERAL CLEO", "PLASTIK SAMBAL"];

    let resepData = JSON.parse(localStorage.getItem('nyGoanResep')) || [];
    let currentTotals = {};

    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.remove('hidden');
        if (id === 'tab-sales') {
            document.getElementById('btn-sales').classList.add('active');
            renderSales(); 
        } else {
            document.getElementById('btn-resep').classList.add('active');
            initBahan();
        }
    }

    function initBahan() {
        const sel = document.getElementById('mBahanSelect');
        sel.innerHTML = BARANG_TETAP.map(b => `<option value="${b}">${b}</option>`).join('');
        renderResep();
    }

    function addResep() {
        const menu = document.getElementById('mName').value;
        const bahan = document.getElementById('mBahanSelect').value;
        const qty = parseFloat(document.getElementById('mQty').value);
        if(!menu || isNaN(qty)) return alert("Isi data!");
        resepData.push({ id: Date.now(), menu: menu.toUpperCase(), bahan, qty });
        localStorage.setItem('nyGoanResep', JSON.stringify(resepData));
        renderResep();
        document.getElementById('mQty').value = '';
    }

    function renderResep() {
        document.getElementById('bodyResep').innerHTML = resepData.map(r => `<tr><td>${r.menu}</td><td>${r.bahan}</td><td>${r.qty}</td><td><button onclick="del(${r.id})" style="color:red; border:none; background:none;">Hapus</button></td></tr>`).join('');
    }

    function del(id) {
        resepData = resepData.filter(r => r.id !== id);
        localStorage.setItem('nyGoanResep', JSON.stringify(resepData));
        renderResep();
    }

    function renderSales() {
        const unique = [...new Set(resepData.map(r => r.menu))];
        const body = document.getElementById('bodySales');
        if(unique.length === 0) {
            body.innerHTML = "<tr><td colspan='2' style='text-align:center;'>Belum ada resep. Klik 'Setelan'.</td></tr>";
            return;
        }
        body.innerHTML = unique.map(m => `<tr><td><strong>${m}</strong></td><td><input type="number" class="sales-input big-input" data-menu="${m}" value="0" style="margin:0; padding:8px;"></td></tr>`).join('');
    }

    function calculateTotal() {
        currentTotals = {};
        BARANG_TETAP.forEach(b => currentTotals[b] = 0);
        document.querySelectorAll('.sales-input').forEach(input => {
            const mName = input.getAttribute('data-menu');
            const sold = parseFloat(input.value) || 0;
            resepData.filter(r => r.menu === mName).forEach(res => {
                currentTotals[res.bahan] += (res.qty * sold);
            });
        });
        document.getElementById('bodyFinal').innerHTML = BARANG_TETAP.map(b => `
            <tr class="${currentTotals[b] > 0 ? 'row-active' : ''}">
                <td>${b}</td>
                <td><span class="${currentTotals[b] > 0 ? 'badge-qty' : ''}">${currentTotals[b]}</span></td>
            </tr>
        `).join('');
        document.getElementById('resultSection').classList.remove('hidden');
    }

    function copyOnlyNumbers() {
        let text = BARANG_TETAP.map(b => currentTotals[b]).join('\r\n');
        const el = document.createElement("textarea");
        el.value = text; document.body.appendChild(el); el.select();
        document.execCommand('copy'); document.body.removeChild(el);
        alert("Berhasil disalin!");
    }

    // PERBAIKAN: Langsung tampilkan menu saat pertama kali buka
    window.onload = () => { renderSales(); };
</script>
</body>
</html>
